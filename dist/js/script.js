"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openDatabase",value:function(){return navigator.serviceWorker?idb.open("restaurant",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("by-date","time")}):Promise.resolve()}},{key:"fetchRestaurants",value:function(t){i.showCachedRestaurants(t).then(function(){fetch(i.DATABASE_URL).then(function(e){return e.json()}).then(function(n){return i.openDatabase().then(function(e){if(e){var t=e.transaction("restaurants","readwrite").objectStore("restaurants");n.forEach(function(e){t.put(e)})}}),t(null,n)}).catch(function(e){return t(e,null)})})}},{key:"showCachedRestaurants",value:function(t){return i.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").getAll().then(function(e){console.log(e),t(null,e)})})}},{key:"fetchRestaurantById",value:function(r,a){i.showCachedRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.id==r});a(null,n[0])}}).then(function(){fetch(i.DATABASE_URL+"/"+r).then(function(e){return e.json()}).then(function(e){return a(null,e)}).catch(function(e){return a(e,null)})})}},{key:"fetchRestaurantByCuisine",value:function(r,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(n=n.filter(function(e){return e.neighborhood==a})),o(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){i.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){i.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return e.photograph?"/img/"+e.photograph+".jpg":(console.log(e.photograph),"#")}},{key:"nameForRestaurant",value:function(e){return""+e.name}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),i}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(e){DBHelper.openDatabase(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,t.setAttribute("role","menuitem"),n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.setAttribute("role","menuitem"),t.value=e,n.append(t)})},window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,o=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,o,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("li"),n=document.createElement("img");n.className="restaurant-img",n.alt="An image of"+e.name+" Restaurant in "+e.neighborhood,n.src=DBHelper.imageUrlForRestaurant(e),t.append(n);var r=document.createElement("h3");r.innerHTML=e.name,t.append(r);var a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);var o=document.createElement("p");o.innerHTML=e.address,t.append(o);var i=document.createElement("a");return i.innerHTML="View Details",i.setAttribute("role","button"),i.setAttribute("aria-label","More Information About"+e.name),i.href=DBHelper.urlForRestaurant(e),t.append(i),t.setAttribute("role","article"),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})};var map,restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.alt="an image of "+DBHelper.nameForRestaurant(e)+" restaurant in "+e.neighborhood,t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li");t.role="tree-item";var n=document.createElement("div");t.appendChild(n);var r=document.createElement("h3");r.innerHTML=e.name,r.className="name",r.setAttribute("tabindex","0"),n.appendChild(r);var a=document.createElement("p");a.innerHTML=e.date,a.className="date",a.setAttribute("tabindex","0"),n.appendChild(a);var o=document.createElement("p");o.innerHTML="Rating: "+e.rating,o.className="rating",o.setAttribute("tabindex","0"),t.appendChild(o);var i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),i.setAttribute("tabindex","0"),t.setAttribute("role","article"),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-current","page"),t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},startServiceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("Registration worked!")}).catch(function(){console.log("Registration failed!")})},startServiceWorker();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyIsInJlc3RhdXJhbnRfaW5mby5qcyIsInN3LXJlZ2lzdHJhdGlvbi5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURiIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwiY3JlYXRlSW5kZXgiLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhbGxiYWNrIiwic2hvd0NhY2hlZFJlc3RhdXJhbnRzIiwidGhlbiIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwicmVzdGF1cmFudHMiLCJvcGVuRGF0YWJhc2UiLCJkYiIsInN0b3JlIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsImZvckVhY2giLCJyZXN0YXVyYW50IiwicHV0IiwiY2F0Y2giLCJlIiwiZ2V0QWxsIiwiY29uc29sZSIsImxvZyIsImlkIiwiZXJyb3IiLCJmaWx0ZXIiLCJyIiwiY3Vpc2luZSIsImZldGNoUmVzdGF1cmFudHMiLCJyZXN1bHRzIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsIm5hbWUiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibWFya2VycyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsInNldEF0dHJpYnV0ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJ3aW5kb3ciLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZSIsImNsYXNzTmFtZSIsImFsdCIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwicHVzaCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJmaWxsQnJlYWRjcnVtYiIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJuYW1lRm9yUmVzdGF1cmFudCIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwicm9sZSIsInJldmlld0hlYWQiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJicmVhZGNydW1iIiwicmVwbGFjZSIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzdGFydFNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6ImlZQUdNQSwwSEFJRixPQUFLQyxVQUFVQyxjQUlSQyxJQUFJQyxLQUFLLGFBQWMsRUFBRyxTQUFTQyxHQUM1QkEsRUFBVUMsa0JBQWtCLGNBQWUsQ0FDckRDLFFBQVMsT0FFTEMsWUFBWSxVQUFXLFVBUHRCQyxRQUFRQyxtREF1QktDLEdBRXRCWCxFQUFTWSxzQkFBc0JELEdBQVVFLEtBQUssV0FDNUNDLE1BQU1kLEVBQVNlLGNBQWNGLEtBQUssU0FBQUcsR0FBQSxPQUFZQSxFQUFTQyxTQUN0REosS0FBSyxTQUFBSyxHQVVKLE9BVEFsQixFQUFTbUIsZUFBZU4sS0FBSyxTQUFTTyxHQUNwQyxHQUFLQSxFQUFMLENBRUEsSUFDSUMsRUFES0QsRUFBR0UsWUFBWSxjQUFlLGFBQ3hCQyxZQUFZLGVBQzNCTCxFQUFZTSxRQUFRLFNBQVNDLEdBQzNCSixFQUFNSyxJQUFJRCxRQUdQZCxFQUFTLEtBQU1PLEtBRXZCUyxNQUFNLFNBQUFDLEdBQUEsT0FBS2pCLEVBQVNpQixFQUFHLHdEQU9DakIsR0FFM0IsT0FBT1gsRUFBU21CLGVBQWVOLEtBQUssU0FBU08sR0FDM0MsR0FBS0EsRUFJTCxPQUZZQSxFQUFHRSxZQUFZLGVBQ3hCQyxZQUFZLGVBQ0ZNLFNBQVNoQixLQUFLLFNBQUNLLEdBQzFCWSxRQUFRQyxJQUFJYixHQUNaUCxFQUFTLEtBQU1PLG1EQVNNYyxFQUFJckIsR0FFN0JYLEVBQVNZLHNCQUFzQixTQUFDcUIsRUFBT2YsR0FDckMsR0FBSWUsRUFDRnRCLEVBQVNzQixFQUFPLFVBQ1gsQ0FFTCxJQUFNUixFQUFhUCxFQUFZZ0IsT0FBTyxTQUFBQyxHQUFBLE9BQUtBLEVBQUVILElBQU1BLElBQ25EckIsRUFBUyxLQUFNYyxFQUFXLE9BRTNCWixLQUFLLFdBQ05DLE1BQU1kLEVB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R0FBQUEsVUFBQSxHQUFwQkYsS0FBSzNDLFdBQzFCdUgsRUFBYWpGLFNBQVNXLGVBQWUsY0FDckM4QixFQUFLekMsU0FBU2EsY0FBYyxNQUNsQzRCLEVBQUczQixVQUFZcEQsRUFBV3lCLEtBQzFCc0QsRUFBR3pCLGFBQWEsZUFBZSxRQUMvQmlFLEVBQVdaLFlBQVk1QixJQU16QmdCLG1CQUFxQixTQUFDdEUsRUFBTU8sR0FDckJBLElBQ0hBLEVBQU15QixPQUFPa0MsU0FBU0osTUFDeEI5RCxFQUFPQSxFQUFLK0YsUUFBUSxVQUFXLFFBQy9CLElBQ0UzRyxFQURZLElBQUk0RyxPQUFKLE9BQWtCaEcsRUFBbEIscUJBQ0lpRyxLQUFLMUYsR0FDdkIsT0FBS25CLEVBRUFBLEVBQVEsR0FFTjhHLG1CQUFtQjlHLEVBQVEsR0FBRzJHLFFBQVEsTUFBTyxNQUQzQyxHQUZBLE1DektYSSxtQkFBb0IsV0FDWHBKLFVBQVVDLGVBRWZELFVBQVVDLGNBQWNvSixTQUFTLFVBQVV6SSxLQUFLLFdBQzlDaUIsUUFBUUMsSUFBSSwwQkFDWEosTUFBTSxXQUNQRyxRQUFRQyxJQUFJLDJCQUlsQnNIIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuICBzdGF0aWMgb3BlbkRhdGFiYXNlKCkge1xyXG4gICAgLy8gSWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHNlcnZpY2Ugd29ya2VyLFxyXG4gICAgLy8gd2UgZG9uJ3QgY2FyZSBhYm91dCBoYXZpbmcgYSBkYXRhYmFzZVxyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnQnLCAxLCBmdW5jdGlvbih1cGdyYWRlRGIpIHtcclxuICAgICAgdmFyIHN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcclxuICAgICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdG9yZS5jcmVhdGVJbmRleCgnYnktZGF0ZScsICd0aW1lJyk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBcclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gICAgICAgXHJcbiAgICBEQkhlbHBlci5zaG93Q2FjaGVkUmVzdGF1cmFudHMoY2FsbGJhY2spLnRoZW4oKCkgPT4ge1xyXG4gICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbihkYikge1xyXG4gICAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xyXG4gICAgICBcclxuICAgICAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgIHZhciBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG4gICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbihyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlID0+IGNhbGxiYWNrKGUsIG51bGwpKTtcclxuICAgIH0pO1xyXG4gIFxyXG4gIH0gXHJcbiAgIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjYWNoZWQgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIHNob3dDYWNoZWRSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gIFxyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24oZGIpIHtcclxuICAgICAgaWYgKCFkYiApIHJldHVybjtcclxuICBcclxuICAgICAgdmFyIGluZGV4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJylcclxuICAgICAgICAub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgIHJldHVybiBpbmRleC5nZXRBbGwoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgICAgXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIFxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgIERCSGVscGVyLnNob3dDYWNoZWRSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGlkXHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRbMF0pO1xyXG4gICAgICB9XHJcbiAgICB9KS50aGVuKCgpID0+IHtcclxuICAgICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICsgJy8nICsgaWQpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50ID0+IGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpKVxyXG4gICAgICAuY2F0Y2goZSA9PiBjYWxsYmFjayhlLCBudWxsKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICBpZihyZXN0YXVyYW50LnBob3RvZ3JhcGgpe1xyXG4gICAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgKTtcclxuICAgIH1lbHNle1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50LnBob3RvZ3JhcGgpO1xyXG4gICAgICByZXR1cm4gKGAjYCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IG5hbWUuXHJcbiAgICovXHJcbiAgc3RhdGljIG5hbWVGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYCR7cmVzdGF1cmFudC5uYW1lfWApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG4iLCJsZXQgcmVzdGF1cmFudHMsXHJcbiAgbmVpZ2hib3Job29kcyxcclxuICBjdWlzaW5lc1xyXG52YXIgbWFwXHJcbnZhciBtYXJrZXJzID0gW11cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcclxuICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKTtcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcclxuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwibWVudWl0ZW1cIik7XHJcbiAgICBcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblxyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZShcInJvbGVcIixcIm1lbnVpdGVtXCIpO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgem9vbTogMTIsXHJcbiAgICBjZW50ZXI6IGxvYyxcclxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIH0pO1xyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcclxuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICB1bC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2UuYWx0ID1cIkFuIGltYWdlIG9mXCIrIHJlc3RhdXJhbnQubmFtZSArXCIgUmVzdGF1cmFudCBpbiBcIiArIHJlc3RhdXJhbnQubmVpZ2hib3Job29kIDtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbGkuYXBwZW5kKGltYWdlKTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnOyAgICBcclxuICBtb3JlLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJidXR0b25cIik7ICBcclxuICBtb3JlLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJNb3JlIEluZm9ybWF0aW9uIEFib3V0XCIrcmVzdGF1cmFudC5uYW1lKTtcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG4gIGxpLnNldEF0dHJpYnV0ZShcInJvbGVcIiAsIFwiYXJ0aWNsZVwiKTtcclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnQ7XHJcbnZhciBtYXA7XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2UuYWx0PSBcImFuIGltYWdlIG9mIFwiKyBEQkhlbHBlci5uYW1lRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSArIFwiIHJlc3RhdXJhbnQgaW4gXCIgKyByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3c1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xyXG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcclxuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcblxyXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcclxuXHJcbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcclxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xyXG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcblxyXG4gIGlmICghcmV2aWV3cykge1xyXG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xyXG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICB9KTtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsgIFxyXG4gIGxpLnJvbGU9XCJ0cmVlLWl0ZW1cIjtcclxuICBjb25zdCByZXZpZXdIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmV2aWV3SGVhZCk7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcbiAgbmFtZS5jbGFzc05hbWUgPSAnbmFtZSc7XHJcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLFwiMFwiKTsgIFxyXG4gIHJldmlld0hlYWQuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblxyXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcclxuICBkYXRlLmNsYXNzTmFtZSA9ICdkYXRlJztcclxuICBkYXRlLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsXCIwXCIpO1xyXG4gIHJldmlld0hlYWQuYXBwZW5kQ2hpbGQoZGF0ZSk7XHJcbiAgXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuICByYXRpbmcuY2xhc3NOYW1lID0gJ3JhdGluZyc7XHJcbiAgcmF0aW5nLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsXCIwXCIpO1xyXG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XHJcbiAgXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuICBjb21tZW50cy5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLFwiMFwiKTtcclxuICBsaS5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJhcnRpY2xlXCIpO1xyXG4gIFxyXG4gIHJldHVybiBsaTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XHJcbiAqL1xyXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50PXNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1jdXJyZW50XCIsXCJwYWdlXCIpO1xyXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuIiwiLyoqXHJcbiAqIHN0YXJ0IHNldmljZSB3b3JrZXIgUmVnaXN0cmF0aW9uLlxyXG4gKi9cclxuc3RhcnRTZXJ2aWNlV29ya2VyID0oKSA9PnsgXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcbiAgXHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1JlZ2lzdHJhdGlvbiB3b3JrZWQhJyk7XHJcbiAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1JlZ2lzdHJhdGlvbiBmYWlsZWQhJyk7XHJcbiAgICB9KTtcclxuXHJcbn07XHJcbnN0YXJ0U2VydmljZVdvcmtlcigpOyJdfQ==
